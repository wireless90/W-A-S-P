using MediatR;
using WASP.Domain.Entities;

namespace WASP.Core.MainContext.Commands.ExecutionVulnerabilityScan
{
    public class ExecutionVulnerabilityScanQueryHandler : IRequestHandler<ExecutionVulnerabilityScanQuery, Unit>
    {
        private readonly IEnumerable<LolBin> _lolBins;

        public ExecutionVulnerabilityScanQueryHandler(IEnumerable<LolBin> lolBins)
        {
            _lolBins = lolBins;
        }

        public Task<Unit> Handle(ExecutionVulnerabilityScanQuery request, CancellationToken cancellationToken)
        {
            _lolBins
                .ToList()
                .ForEach(lolBin =>
                {
                    lolBin
                        .Vulnerabilities
                        .ForEach(vulnerability => {
                            vulnerability.TryExploit();
                            vulnerability.Cleanup();
                        });
                });

            return Unit.Task;
        }
    }
}
